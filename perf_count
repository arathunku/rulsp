#!/usr/bin/bash
cargo bench --no-run && \
    perf record -g target/release/rulsp-* --bench counting && \
    perf script | ~/Applications/FlameGraph/stackcollapse-perf.pl | ~/Applications/FlameGraph/flamegraph.pl > flame-counting.svg


rm callgrind.*
cargo build --release && \
    valgrind --tool=callgrind target/release/rulsp

callgrind_annotate callgrind.out.* | grep "[[:space:]]src\/*" | head -n 10
